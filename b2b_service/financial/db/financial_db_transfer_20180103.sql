-- ----------------------------
-- Table transfer for account module
-- ----------------------------

-- platform account is new table

#INSERT INTO `financial_db`.`account_alipay`(`id`, `organization_id`, `account_name`, `app_id`, `bank_no`, `app_public_secret`, `app_private_secret`, `back_type`, `open_flag`, `create_time`, `update_time`) VALUES (1, 14, '', '2018022162645163', '', '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', 1, 1, '2018-05-21 11:00:08', '2018-07-21 15:23:48');
#INSERT INTO `financial_db`.`account_alipay`(`id`, `organization_id`, `account_name`, `app_id`, `bank_no`, `app_public_secret`, `app_private_secret`, `back_type`, `open_flag`, `create_time`, `update_time`) VALUES (4, 1, '收款账户名称', '2016102100730692', '', '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', 1, 1, '2018-07-12 11:30:54', '2018-07-21 15:23:54');

#INSERT INTO `financial_db`.`account_kuaiqian`(`id`, `organization_id`, `account_name`, `bank_no`, `merchan_acct_id`, `sign_file_url`, `sign_pwd`, `sign_private_key`, `check_sign_file_url`, `back_type`, `open_flag`, `create_time`, `update_time`) VALUES (1, 1, '测试组织', '', '1001214035601', 'payconfig/kuaiqian/test/10012140356.pfx', 'bat2018', 'test-alias', 'payconfig/kuaiqian/test/CFCA_sandbox.cer', 1, 1, '2018-05-24 10:01:49', '2018-05-24 10:01:52');
#INSERT INTO `financial_db`.`account_kuaiqian`(`id`, `organization_id`, `account_name`, `bank_no`, `merchan_acct_id`, `sign_file_url`, `sign_pwd`, `sign_private_key`, `check_sign_file_url`, `back_type`, `open_flag`, `create_time`, `update_time`) VALUES (2, 3, '', '', '1021023779601', 'payconfig/kuaiqian/prod/99bill-rsa.pfx', 'rqbat2018', '20180526.3300000384874314', 'payconfig/kuaiqian/prod/99bill.RSA.cer', 1, 1, '2018-05-24 10:01:49', '2018-05-24 10:01:52');

INSERT INTO financial_db.account_offline(id,
                                         organization_id,
                                         currency_code,
                                         account_name,
                                         bank_no,
                                         card_no,
                                         bank_name,
                                         bank_addr,
                                         open_flag,
                                         create_time,
                                         update_time)
SELECT id,
       1,
       'CNY',
       `name`,
       card_no as                                               bank_no,
       card_no,
       bank_name,
       null,
       1,
       FROM_UNIXTIME(`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(`update_time` / 1000, '%Y-%m-%d %H:%i:%S') update_time
FROM b2b.bank_account;

INSERT INTO financial_db.account_alipay_distributor(id,
                                                    distributor_id,
                                                    distributor_name,
                                                    distributor_company_name,
                                                    account_name,
                                                    app_id,
                                                    app_public_secret,
                                                    app_private_secret,
                                                    create_time,
                                                    update_time)
SELECT aa.id,
       da.distributor_id,
       di.name,
       di.company_name,
       aa.app_name,
       aa.app_id,
       aa.app_public_secret,
       aa.app_private_secret,
       FROM_UNIXTIME(aa.`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(aa.`update_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time
FROM b2b.alipay_account aa,
     b2b.distributor_alipay da,
     b2b.distributor_info di
WHERE aa.id = da.alipay_account_id
  and da.distributor_id = di.id;

INSERT INTO financial_db.account_wx_distributor(id,
                                                distributor_id,
                                                distributor_name,
                                                distributor_company_name,
                                                account_name,
                                                app_id,
                                                apiclient_key,
                                                serial_number,
                                                certificate_invalid_time,
                                                app_key,
                                                app_type,
                                                account_no,
                                                version,
                                                create_time,
                                                update_time)
SELECT aa.id,
       da.distributor_id,
       di.name,
       di.company_name,
       aa.account_name,
       aa.app_id,
       null,
       null,
       null,
       -- app_secret,
       aa.app_key,
       aa.app_type,
       aa.account_no,
       'V2' AS                                                     version,
       FROM_UNIXTIME(aa.`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(aa.`update_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time
FROM b2b.wx_account aa,
     b2b.distributor_wx da,
     b2b.distributor_info di
WHERE aa.id = da.wx_account_id
  and da.distributor_id = di.id;


-- ----------------------------
-- Table transfer for currency module
-- ----------------------------
INSERT INTO financial_db.currency(id,
                                  name,
                                  currency_code,
                                  money_accuracy,
                                  erp_no,
                                  open_flag,
                                  create_time,
                                  update_time)
SELECT id,
       name,
       currency_code,
       money_accuracy,
       erp_code,
       IF(state = 'A', 1, 0),
       FROM_UNIXTIME(`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(`update_time` / 1000, '%Y-%m-%d %H:%i:%S') update_time
FROM b2b.erp_currency;

INSERT INTO financial_db.currency_rate(id,
                                       exchange_rate,
                                       reverse_ex_rate,
                                       cy_forid,
                                       cy_toid,
                                       beg_date,
                                       create_time,
                                       update_time)
SELECT id,
       exchange_rate,
       reverse_ex_rate,
       cy_forid,
       cy_toid,
       FROM_UNIXTIME(`beg_date` / 1000, '%Y-%m-%d %H:%i:%S')    create_time,
       FROM_UNIXTIME(`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(`update_time` / 1000, '%Y-%m-%d %H:%i:%S') update_time
FROM b2b.b2b_rate;


-- ----------------------------
-- Table transfer for deposit module
-- ----------------------------
INSERT INTO `financial_db`.`deposit`(`id`, `is_show_prestore`, `is_open_online_topup`, `online_min_amount`,
                                     `is_open_offline_topup`, `is_open_withdrawal`, `create_time`, `update_time`)
VALUES (1, 0, 0, 0, 0, 0, 0, 0);


INSERT INTO financial_db.deposit_distributor(distributor_id,
                                             distributor_name,
                                             erp_distributor_id,
                                             tree_node,
                                             distributor_ancestor_id,
                                             distributor_ancestor_name,
                                             account_balance,
                                             account_available,
                                             freezing_amount,
                                             recharge_amount,
                                             commission_amount,
                                             withdraw_amount,
                                             consumer_amount,
                                             refund_amount,
                                             create_time,
                                             update_time)
SELECT a.distributor_id,
       b.`name`                                                   distributor_name,
       b.erp_distributor_id                                       erp_distributor_id,
       0                                                          tree_node,
       a.distributor_id                                           distributor_ancestor_id,
       b.`name`                                                   distributor_ancestor_name,
       a.account_balance,
       a.account_available,
       a.freezing_amount,
       a.recharge_amount,
       0                                                          commission_amount,
       a.withdraw_amount,
       a.consumer_amount,
       refund_amount,
       FROM_UNIXTIME(a.`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(a.`update_time` / 1000, '%Y-%m-%d %H:%i:%S') update_time
FROM b2b.deposit_account a,
     b2b.distributor_info b
WHERE a.distributor_id = b.id
  and b.erp_distributor_no is not null
GROUP BY b.erp_distributor_no;

INSERT INTO financial_db.deposit_distributor_freezing(id,
                                                      deposit_distributor_id,
                                                      distributor_id,
                                                      distributor_name,
                                                      freezing_amount,
                                                      `status`,
                                                      business_type,
                                                      business_id,
                                                      remark,
                                                      create_time,
                                                      update_time)
SELECT id,
       account_id,
       distributor_id,
       distributor_name,
       freezing_amount,
       freezing_status,
       freezing_type,
       withdraw_id,
       remark,
       FROM_UNIXTIME(`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(`update_time` / 1000, '%Y-%m-%d %H:%i:%S') update_time
FROM b2b.freezing;

INSERT INTO financial_db.deposit_distributor_subsidiary_book(id,
                                                             deposit_distributor_id,
                                                             distributor_id,
                                                             distributor_name,
                                                             business_type,
                                                             business_id,
                                                             change_type,
                                                             amount,
                                                             before_deposit_amount,
                                                             after_deposit_amount,
                                                             remark,
                                                             create_time)
SELECT id,
       account_id,
       distributor_id,
       distributor_name,
       CASE
           operate_type
           WHEN 2 THEN
               3
           WHEN 3 THEN
               2
           ELSE operate_type
           END,
       order_id,
       change_type,
       amount,
       before_amount,
       after_amount,
       remark,
       FROM_UNIXTIME(`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time
FROM b2b.deposit_admin_detail;

INSERT INTO withdraw_deposits_distributor_apply(id,
                                                distributor_id,
                                                distributor_name,
                                                withdraw_amount,
                                                apply_status,
                                                withdraw_account_type,
                                                wx_alipay_account,
                                                card_no,
                                                payee,
                                                bank_name,
                                                remark,
                                                create_time,
                                                update_time)
SELECT a.id,
       a.distributor_id,
       a.distributor_name,
       a.withdraw_amount,
       a.confirm_status,
       a.withdraw_type,
       b.line_account,
       b.card_no,
       b.payee,
       b.bank_name,
       a.remark,
       FROM_UNIXTIME(a.`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(a.`update_time` / 1000, '%Y-%m-%d %H:%i:%S') update_time
FROM b2b.withdraw a,
     b2b.withdraw_bank_account b
where a.id = b.withdraw_id;

-- ----------------------------
-- Table transfer for pay_bills module
-- ----------------------------

-- ----------------------------
-- Table transfer for refund module
-- ----------------------------
INSERT INTO financial_db.refund_distributor_apply(id,
                                                  distributor_id,
                                                  distributor_name,
                                                  distributor_refund_id,
                                                  business_types,
                                                  business_id,
                                                  amount,
                                                  cash_amount,
                                                  deposit_amount,
                                                  refund_type,
                                                  refund_mode,
                                                  apply_status,
                                                  remark,
                                                  operator_id,
                                                  operator_name,
                                                  create_time,
                                                  update_time)
SELECT id,
       distributor_id,
       distributor_name,
       null,
       -- company_name,
       case business_types
           when 1 then 1
           when 2 then 1
           when 3 then 1
           when 4 then 2
           else 3
           end,
       business_id,
       amount,
       case refund_type
           when 1 then amount
           end,
       case refund_type
           when 2 then amount
           end,
       refund_type,
       1,
       status,
       remark,
       operation_id,
       operation_name,
       FROM_UNIXTIME(`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(`update_time` / 1000, '%Y-%m-%d %H:%i:%S') update_time
FROM b2b.refund_apply;

-- ----------------------------
-- Table transfer for voucher module
-- ----------------------------

INSERT INTO financial_db.voucher_distributor(id,
                                             distributor_id,
                                             distributor_name,
                                             company_name,
                                             amount,
                                             pay_way,
                                             out_trade_no,
                                             customer_flag,
                                             currency_type,
                                             business_type,
                                             business_id,
                                             voucher_status,
                                             remark,
                                             voucher_erp_no,
                                             create_time,
                                             update_time)
SELECT b2b.voucher.id,
       b2b.voucher.distributor_id,
       b2b.voucher.distributor_name,
       b2b.distributor_info.company_name,
       b2b.voucher.amount,
       CASE b2b.voucher.way
           WHEN 1 THEN 1
           WHEN 2 THEN 2
           WHEN 3 THEN 3
           WHEN 4 THEN 4
           WHEN 6 THEN 6 END,
       null,
       0,
       IF
           (b2b.voucher.coin_type, 1, 'CNY')
        ,
       CASE b2b.voucher.business_types
           WHEN 1 THEN 1
           WHEN 3 THEN 2
           else 0
           END,
       CASE b2b.voucher.business_types
           WHEN 1 THEN b2b.voucher.business_id
           END,
       b2b.voucher.status,
       b2b.voucher.remark,
       b2b.voucher.voucher_erp_no,
       FROM_UNIXTIME(b2b.voucher.`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(b2b.voucher.`update_time` / 1000, '%Y-%m-%d %H:%i:%S') update_time
FROM b2b.voucher,
     b2b.distributor_info
where b2b.voucher.distributor_id = b2b.distributor_info.id;

INSERT INTO `financial_db`.`pay_bills_distributor` (id,
                                                    `out_trade_no`,
                                                    `distributor_id`,
                                                    `distributor_name`,
                                                    `pay_type`,
                                                    `business_type`,
                                                    `business_id`,
                                                    `pay_status`,
                                                    `total_fee`,
                                                    `order_title`,
                                                    `order_describe`,
                                                    `product_id`,
                                                    `online_trade_no`,
                                                    `expire_time`,
                                                    `pay_time`,
                                                    `create_time`,
                                                    `update_time`,
                                                    `pay_method`,
                                                    `trade_mode`,
                                                    `payee_id`,
                                                    `organization_id`,
                                                    `app_id`)
SELECT b2b.pay_order.id,
       b2b.pay_order.out_trade_no,
       b2b.pay_order.distributor_id,
       b2b.pay_order.distributor_name,
       b2b.pay_order.pay_type,
       case ext when 1 then 2 when 2 then 1 else 1 end,
       b2b.pay_order.sub_ext,
       b2b.pay_order.pay_status,
       b2b.pay_order.total_amount,
       b2b.pay_order.order_title,
       b2b.pay_order.order_describe,
       b2b.pay_order.product_id,
       b2b.pay_order.online_trade_no,
       null,
       FROM_UNIXTIME(`pay_time` / 1000, '%Y-%m-%d %H:%i:%S')    pay_time,
       FROM_UNIXTIME(`create_time` / 1000, '%Y-%m-%d %H:%i:%S') create_time,
       FROM_UNIXTIME(`update_time` / 1000, '%Y-%m-%d %H:%i:%S') update_time,
       null,
       null,
       null,
       null,
       null
from b2b.pay_order
GROUP BY b2b.pay_order.sub_ext
HAVING count(*) = 1
   and b2b.pay_order.id > 118